<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>MEN - MEN 16Z001 host driver for Linux - Main Page</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<meta name="Language" content="en, english">
<meta name="Copyright" content="All material copyright MEN Mikro Elektronik GmbH">
<link href="men_stylesheet.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class="left_to_right" style="padding-top: 6px; background-color: #F0F0F0; height: 110px; border-bottom: 2px solid #D1D1D2;">
	<!-- Titel -->
	<img src="menlogo.gif" alt="MEN" style="float: left; height: 103px; width: 155px; margin: 0px;">
	<h1 style="margin: 0px; padding-top: 35px; padding-bottom: 0px;">MEN 16Z001 host driver for Linux &nbsp; </h1>
	<h3>Main Page</h3>
</div>

<div class="left_to_right">
<!-- Hauptteil -->
	<div class="main">
<!-- Generated by Doxygen 1.3.2 -->
<div class="qindex"><a class="qindexHL" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>MEN 16Z001 host driver for Linux Documentation</h1>
<p>
This is the documentation of the Linux low-level driver for the MEN 16Z001 I2C host.<h2><a name="General"></a>
General</h2>
The 16Z001 is an I2C/SMB host controller compatible to the ALI 15x3 I2C module. It supports the following SMB clock frequencies:<p>
<ul>
<li>37 kHz</li><li>55 kHz</li><li>74 kHz</li><li>111 kHz</li><li>149 kHz</li><li>223 kHz <br>
</li></ul>
<p>
The default frequency used when smbClk is not passed is 74 kHz. A frequency value is passed in [kHz] unit during the modprobe call: <div class="fragment"><pre>
    #/modprobe men_lx_z001 smbClk=37    for 37 kHz or
    #/modprobe men_lx_z001 smbClk=111   for 111 kHz
</pre></div><h2><a name="The"></a>
driver consists of the following files:</h2>
<a class="el" href="z001__smb_8c.html">z001_smb.c</a> Adapter driver, similar to i2c-ali15x3<br>
 <a class="el" href="z001__smb_8h.html">z001_smb.h</a> Header file for driver<br>
 driver.mak Makefile part for building Driver as Part of MDIS <a class="el" href="z001__smb__doc_8c.html">z001_smb_doc.c</a> Source for software documentation Makefile MDIS demo Makefile<h2><a name="build_install"></a>
Build/Install</h2>
The Driver is primarily built in conjunction with the Linux MDIS package. The resulting kernel module men_lx_z001(_io) depends on Functions in the men_oss and men_chameleon modules.<p>
Therefore the most recent Linux MDIS5 Package 13MD05-90 from MEN Website is needed to build the driver.<h2><a name="test"></a>
Usage / Test example</h2>
The following example/test was performed to verify the functionality of the driver:<p>
CPU board: 02F014-00 Target: 02F210 GPS/GSM Module with Onboard FPGA<p>
<div class="fragment"><pre>

  The utilities i2cdetect and i2cdump are used to verify the showup of
  the additional 2 SMBus devices when the Driver is loaded.

  The Linux Kernelmodule of the 16Z001 driver is loaded via 
  modprobe men_lx_z001

  -sh-3.00# i2cdetect
  Error: No i2c-bus specified!
  Syntax: i2cdetect [-y] [-a] [-q|-r] I2CBUS [FIRST LAST]
  i2cdetect -l
  i2cdetect -V
  I2CBUS is an integer
  With -a, probe all addresses (NOT RECOMMENDED)
  With -q, uses only quick write commands for probing (NOT RECOMMENDED)
  With -r, uses only read byte commands for probing (NOT RECOMMENDED)
  If provided, FIRST and LAST limit the probing range.
  With -l, lists installed busses only
  Installed I2C busses:
  i2c-0       unknown     SMBus I801 adapter at 0500  Algorithm unavailable


  -sh-3.00# modprobe men_lx_z001
  -sh-3.00# i2cdetect
  Error: No i2c-bus specified!
  Syntax: i2cdetect [-y] [-a] [-q|-r] I2CBUS [FIRST LAST]
  i2cdetect -l
  i2cdetect -V
  I2CBUS is an integer
  With -a, probe all addresses (NOT RECOMMENDED)
  With -q, uses only quick write commands for probing (NOT RECOMMENDED)
  With -r, uses only read byte commands for probing (NOT RECOMMENDED)
  If provided, FIRST and LAST limit the probing range.
  With -l, lists installed busses only
  Installed I2C busses:
  i2c-2  unknown    16Z001-1 BAR0 offs 0x600      Algorithm unavailable
  i2c-1  unknown    16Z001-0 BAR0 offs 0x500      Algorithm unavailable
  i2c-0  unknown    SMBus I801 adapter at 0500    Algorithm unavailable
  -sh-3.00#

  </pre></div><h2><a name="g22"></a>
CPU Board: MEN G22</h2>
On the G22 the compact serial IO connector carries the I2C signals of the 16Z001 controller located at address 0xf000 in the ISA IO space. A special driver mak file driver_g2x.mak is used to build a IO mapped version of the driver. <br>
 On G22 there are alot I2C busses present due to the i915 chipset driver that implements many busses via bitbang algorithms to read DDC and EDID data from monitors. <br>
 The following dump shows the I2C devices present on a G22 under Ubuntu 12.04, then the load of the driver module followed by accessing a Test cPCI serial adapter. There an I2C EEPROM at address 0x51 is located.<p>
<div class="fragment"><pre>
  root@MENVPC:~# 
  root@MENVPC:~# l /dev/i2c-*
  crw-rw---- 1 root i2c 89,  0 Sep 25 15:47 /dev/i2c-0
  crw-rw---- 1 root i2c 89,  1 Sep 25 15:47 /dev/i2c-1
  crw-rw---- 1 root i2c 89, 10 Sep 25 15:47 /dev/i2c-10
  crw-rw---- 1 root i2c 89, 11 Sep 25 15:47 /dev/i2c-11
  crw-rw---- 1 root i2c 89, 12 Sep 25 15:47 /dev/i2c-12
  crw-rw---- 1 root i2c 89, 13 Sep 25 15:47 /dev/i2c-13
  crw-rw---- 1 root i2c 89, 14 Sep 25 15:47 /dev/i2c-14
  crw-rw---- 1 root i2c 89, 15 Sep 25 15:47 /dev/i2c-15
  crw-rw---- 1 root i2c 89,  2 Sep 25 15:47 /dev/i2c-2
  crw-rw---- 1 root i2c 89,  3 Sep 25 15:47 /dev/i2c-3
  crw-rw---- 1 root i2c 89,  4 Sep 25 15:47 /dev/i2c-4
  crw-rw---- 1 root i2c 89,  5 Sep 25 15:47 /dev/i2c-5
  crw-rw---- 1 root i2c 89,  6 Sep 25 15:47 /dev/i2c-6
  crw-rw---- 1 root i2c 89,  7 Sep 25 15:47 /dev/i2c-7
  crw-rw---- 1 root i2c 89,  8 Sep 25 15:47 /dev/i2c-8
  crw-rw---- 1 root i2c 89,  9 Sep 25 15:47 /dev/i2c-9
  root@MENVPC:~# 
  root@MENVPC:~# 
  root@MENVPC:~# modprobe men_lx_z001_io
  root@MENVPC:~# l /dev/i2c-*
  crw-rw---- 1 root i2c 89,  0 Sep 25 15:47 /dev/i2c-0
  crw-rw---- 1 root i2c 89,  1 Sep 25 15:47 /dev/i2c-1
  crw-rw---- 1 root i2c 89, 10 Sep 25 15:47 /dev/i2c-10
  crw-rw---- 1 root i2c 89, 11 Sep 25 15:47 /dev/i2c-11
  crw-rw---- 1 root i2c 89, 12 Sep 25 15:47 /dev/i2c-12
  crw-rw---- 1 root i2c 89, 13 Sep 25 15:47 /dev/i2c-13
  crw-rw---- 1 root i2c 89, 14 Sep 25 15:47 /dev/i2c-14
  crw-rw---- 1 root i2c 89, 15 Sep 25 15:47 /dev/i2c-15
  crw-rw---- 1 root i2c 89, 16 Sep 25 16:15 /dev/i2c-16
  crw-rw---- 1 root i2c 89,  2 Sep 25 15:47 /dev/i2c-2
  crw-rw---- 1 root i2c 89,  3 Sep 25 15:47 /dev/i2c-3
  crw-rw---- 1 root i2c 89,  4 Sep 25 15:47 /dev/i2c-4
  crw-rw---- 1 root i2c 89,  5 Sep 25 15:47 /dev/i2c-5
  crw-rw---- 1 root i2c 89,  6 Sep 25 15:47 /dev/i2c-6
  crw-rw---- 1 root i2c 89,  7 Sep 25 15:47 /dev/i2c-7
  crw-rw---- 1 root i2c 89,  8 Sep 25 15:47 /dev/i2c-8
  crw-rw---- 1 root i2c 89,  9 Sep 25 15:47 /dev/i2c-9
  root@MENVPC:~# 
  root@MENVPC:~# i2cdetect -y 16
  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
  00:          -- -- -- -- -- -- -- -- -- -- -- -- -- 
  10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
  20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
  30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
  40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
  50: -- 51 -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
  60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
  70: -- -- -- -- -- -- -- --                         
  root@MENVPC:~# i2cdump -y 16 0x51
  No size specified (using byte-data access)
  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f    0123456789abcdef
  00: 41 42 43 ff ff ff ff ff ff ff ff ff ff ff ff ff    ABC.............
  10: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................
  20: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................
  30: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................
  40: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................
  50: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................
  60: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................
  70: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................
  80: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................
  90: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................
  a0: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................
  b0: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................
  c0: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................
  d0: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................
  e0: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................
  f0: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................
  root@MENVPC:~# 
  root@MENVPC:~# 
  root@MENVPC:~# i2cdetect -l
  i2c-0   i2c             i915 gmbus disabled                     I2C adapter
  i2c-1   i2c             i915 gmbus ssc                          I2C adapter
  i2c-2   i2c             i915 GPIOB                              I2C adapter
  i2c-3   i2c             i915 gmbus vga                          I2C adapter
  i2c-4   i2c             i915 GPIOA                              I2C adapter
  i2c-5   i2c             i915 gmbus panel                        I2C adapter
  i2c-6   i2c             i915 GPIOC                              I2C adapter
  i2c-7   i2c             i915 gmbus dpc                          I2C adapter
  i2c-8   i2c             i915 GPIOD                              I2C adapter
  i2c-9   i2c             i915 gmbus dpb                          I2C adapter
  i2c-10  i2c             i915 GPIOE                              I2C adapter
  i2c-11  i2c             i915 gmbus reserved                     I2C adapter
  i2c-12  i2c             i915 gmbus dpd                          I2C adapter
  i2c-13  i2c             i915 GPIOF                              I2C adapter
  i2c-14  i2c             DPDDC-C                                 I2C adapter
  i2c-15  i2c             DPDDC-D                                 I2C adapter
  i2c-16  smbus           16Z001-0-0xf000                         SMBus adapter
  root@MENVPC:~# 
  root@MENVPC:~# 
  </pre></div>
	</div>
</div>

<div class="footer">
<!-- Footer -->
	<p class="footer">
	Generated for MEN 16Z001 host driver for Linux using <a href="http://www.doxygen.org">doxygen</a>. All Rights Reserved.
	</p>
</div>

</body>
</html>

